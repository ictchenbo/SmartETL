from: local/db_envs.yaml

name: load arXiv meta flow
description: 读取arXiv-meta数据集，写入ES（仅包含论文meta信息）
arguments: 1

consts:
  type_mapping:
    all: .jsonl

nodes:
  es: util.database.elasticsearch.ES(**es1, index='arxiv-meta')

  select: SelectVal('data')
  rename: RenameFields(id='_id')
  change_id: "Map(lambda s: s.replace('/', ':'), key='_id')"

  write_es: Map('gestata.dbops.upsert', es)

loader: ar.Zip(arg1, 'all', type_mapping=type_mapping)
processor: Chain(select, rename, change_id, Buffer(buffer_size=1000), write_es)

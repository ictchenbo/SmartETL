name: nuclei NL2POC
description: 加载漏洞数据集，筛选出有CVE编号&没有PoC的漏洞，提示大模型进行nuclei模板格式的PoC生成
arguments: 0
consts:
  cve_ids:
    N/A: 1
  llm:
    api_base: https://api.chatanywhere.tech
    model: gpt-4o

loader: JsonArray('data/vul/process_zh-1121.json')

nodes:
  print: Print
  count1: Count(label='level1')
  count2: Count(label='level2')
  count3: Count(label='level3')

  has_poc: util.sets.from_json('data/vul/nuclei_http-1225.jsonl', key_key='_id')
  rename: RenameFields(_id='_parent')
  flat: Flat(key='docs', inherit_props=True)
  select: Select('db_id', 'cve_id', 'CWE', '_parent', 'source', 'description')
  filter1: BlackList(cve_ids, 'cve_id')
  filter2: BlackList(has_poc, 'cve_id')
  filter3: "Filter(lambda v: len(v)>50, key='description')"
  skip: SkipN(0)
  nl2poc_prompt: util.files.text('config/prompt/vul-nl2poc-1.txt')
  nl2poc: model.LLM(**llm, key='description', prompt=nl2poc_prompt, target_key='poc')
  writer: WriteJson('data/vul/vul_no_poc_1225.jsonl', append=True)

processor: Chain(rename, flat, select, count1, filter1, count2, filter2, filter3, skip, count3, nl2poc, print)
